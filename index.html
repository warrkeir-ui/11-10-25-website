# We'll load the existing index.html, modify it to:
# - ensure Director (Stefanie) image appears on the homepage (id="director-photo" or inject a simple hero/about section)
# - update Staff section (id="staff") with staff images
# - update Gallery section (id="gallery") with provided photos
# - make Enrollment packet link auto-download (id="enrollment-download") and remove backup link (id="enrollment-backup")
# - keep the rest of the styling and content identical ("previous design" is the uploaded file)
#
# Finally, save the updated file as /mnt/data/index_updated.html for the user to download.

from bs4 import BeautifulSoup
from pathlib import Path

src_path = Path("/mnt/data/index.html")
html = src_path.read_text(encoding="utf-8", errors="ignore")

soup = BeautifulSoup(html, "html.parser")

# ---------- Enrollment packet ----------
# Ensure an anchor exists with id="enrollment-download"; if found, update; else create a simple section.
packet_filename = "Hakuna-Matatah-Enrollment-Packet.pdf"
packet_path = Path("/mnt/data")/packet_filename
# If the exact file isn't present, fall back to the (1).pdf filename but keep href pointing to the clean filename.
if not packet_path.exists():
    alt = Path("/mnt/data/")/"Hakuna-Matatah-Enrollment-Packet (1).pdf"
    if alt.exists():
        # Save/duplicate to desired name so the site can point at a single clean filename
        packet_path.write_bytes(alt.read_bytes())

enroll_anchor = soup.find(id="enrollment-download")
if enroll_anchor:
    enroll_anchor["href"] = packet_filename
    enroll_anchor["download"] = ""  # empty value enables download in most browsers
    enroll_anchor.string = enroll_anchor.get_text() or "Download Enrollment Packet"
else:
    # Create a section if missing
    sec = soup.new_tag("section", id="enrollment")
    h2 = soup.new_tag("h2")
    h2.string = "Enrollment Packet"
    a = soup.new_tag("a", id="enrollment-download", href=packet_filename)
    a["download"] = ""
    a["class"] = "btn btn-primary"
    a.string = "Download Enrollment Packet"
    sec.append(h2); sec.append(a)
    # Insert before footer if possible, else append to body
    footer = soup.find("footer")
    if footer and footer.parent:
        footer.insert_before(sec)
    else:
        soup.body.append(sec)

# Remove any backup link
backup = soup.find(id="enrollment-backup")
if backup:
    backup.decompose()

# ---------- Director image on home page ----------
director_src = "Stefanie.png"
director_img = soup.find(id="director-photo")
if director_img:
    director_img["src"] = director_src
    if "alt" not in director_img.attrs or not director_img["alt"]:
        director_img["alt"] = "Stefanie D. Boyd — Director"
else:
    # Try to find an "about" or hero section to place director image into
    target = soup.find(id="home") or soup.find("header") or soup.body
    # Create a simple container with the image, keeping classes minimal so existing CSS applies
    wrap = soup.new_tag("div", **{"class": "director-hero"})
    img = soup.new_tag("img", id="director-photo", src=director_src, alt="Stefanie D. Boyd — Director")
    img["style"] = "max-width:220px;border-radius:9999px;box-shadow:0 6px 18px rgba(0,0,0,.15);"
    cap = soup.new_tag("p", **{"class":"subtitle"})
    cap.string = "Meet Our Director: Stefanie D. Boyd"
    wrap.append(img); wrap.append(cap)
    # Insert after the first h1 on the page if present
    h1 = soup.find("h1")
    if h1:
        h1.insert_after(wrap)
    else:
        target.insert(0, wrap)

# ---------- Staff section ----------
staff_imgs = [
    ("Stefanie D. Boyd", "Director", "Stefanie.png"),
    ("Keir W.", "Preschool Lead", "Keir.png"),
    ("Kennedy W.", "Infant Lead", "Kennedy.png"),
    ("Kathy B.", "Toddler Lead", "Kathy.png"),
    ("Heaven", "Infant Room Co-Teacher", "Heaven.png"),
]

staff_section = soup.find(id="staff")
if not staff_section:
    # If no staff section, create one before footer
    staff_section = soup.new_tag("section", id="staff")
    h2 = soup.new_tag("h2"); h2.string = "Our Staff"
    staff_section.append(h2)
    if footer := soup.find("footer"):
        footer.insert_before(staff_section)
    else:
        soup.body.append(staff_section)

# Clear existing grid/cards inside staff section but keep heading
for child in list(staff_section.children):
    if getattr(child, "name", None) and child.name.lower() != "h2":
        child.decompose()

grid = soup.new_tag("div", **{"class":"staff-grid"})
for name, role, src in staff_imgs:
    card = soup.new_tag("div", **{"class":"staff-card"})
    img = soup.new_tag("img", src=src, alt=f"{name} — {role}", loading="lazy")
    img["style"] = "width:160px;height:160px;object-fit:cover;border-radius:9999px;box-shadow:0 8px 24px rgba(0,0,0,.12);"
    h3 = soup.new_tag("h3"); h3.string = name
    p = soup.new_tag("p"); p.string = role
    card.append(img); card.append(h3); card.append(p)
    grid.append(card)

staff_section.append(grid)

# ---------- Gallery section ----------
gallery_images = [
    ("aquarium 1.jpeg", "Aquarium Adventure"),
    ("ridings.jpeg", "Active Play"),
    ("eric robot.jpeg", "STEM Building"),
    ("magnet tiles.jpeg", "Magnet Tiles"),
    ("micah puzzle.jpeg", "Alphabet Puzzle"),
    ("painting.jpeg", "Creative Painting"),
    ("legos.jpeg", "LEGO Time"),
    ("math.jpeg", "Math & Manipulatives"),
    ("Lunch.jpeg", "Family-Style Lunch"),
    ("school.jpeg", "Our Building"),
]

gallery = soup.find(id="gallery")
if not gallery:
    gallery = soup.new_tag("section", id="gallery")
    h2 = soup.new_tag("h2"); h2.string = "Gallery"
    gallery.append(h2)
    # place before footer
    if footer := soup.find("footer"):
        footer.insert_before(gallery)
    else:
        soup.body.append(gallery)

# Remove any existing grid after the h2 (but keep h2)
for child in list(gallery.children):
    if getattr(child, "name", None) and child.name.lower() != "h2":
        child.decompose()

ggrid = soup.new_tag("div", **{"class": "gallery-grid"})
for src, caption in gallery_images:
    fig = soup.new_tag("figure", **{"class":"gallery-item"})
    img = soup.new_tag("img", src=src, alt=caption, loading="lazy")
    cap = soup.new_tag("figcaption"); cap.string = caption
    fig.append(img); fig.append(cap)
    ggrid.append(fig)

gallery.append(ggrid)

# ---------- Minimal CSS to ensure grids look fine if not present ----------
# We'll detect if .staff-grid or .gallery-grid styles exist; if not, add minimal embedded CSS that won't fight the old theme.
need_style = True
for style in soup.find_all("style"):
    if ".staff-grid" in style.get_text() or ".gallery-grid" in style.get_text():
        need_style = False
        break

if need_style:
    style = soup.new_tag("style")
    style.string = """
/* Lightweight grid helpers (keeps your original color/typography) */
.staff-grid, .gallery-grid { display:grid; gap:1.25rem; grid-template-columns: repeat(auto-fit, minmax(220px,1fr)); align-items:start; }
.staff-card { text-align:center; padding:1rem; border-radius:1rem; background:rgba(255,255,255,.6); }
.gallery-item img { width:100%; height:220px; object-fit:cover; border-radius:1rem; box-shadow:0 6px 18px rgba(0,0,0,.12); }
.gallery-item figcaption { margin-top:.5rem; font-size:.95rem; opacity:.8; text-align:center; }
"""
    # Prefer to append into <head>
    if soup.head:
        soup.head.append(style)
    else:
        soup.body.insert(0, style)

# Save updated file
out_path = Path("/mnt/data/index_updated.html")
out_path.write_text(str(soup), encoding="utf-8")

out_path, out_path.exists()
